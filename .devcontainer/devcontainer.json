{
    "name": "raafco-ims-dev",
    "dockerComposeFile": [
        "../docker-compose.yml",
        "docker-compose.override.yml"
    ],
    "service": "app",
    "remoteUser": "vscode",
    "containerUser": "vscode",
    "workspaceFolder": "/var/www/html",
    "shutdownAction": "stopCompose",

    "remoteEnv": {
        "SONARLINT_EXCLUDE_ANALYZERS": "cfamily,java,python",
        "SONAR_SCANNER_OPTS": "-Dsonar.userHome=/home/vscode/.sonarlint"
    },

    "forwardPorts": [5173, 8081, 9003],
    "portsAttributes": {
        "8025": { "label": "mailpit", "onAutoForward": "ignore" },
        "5050": { "label": "pgadmin", "onAutoForward": "ignore" }
    },

    "postCreateCommand": "npm ci || npm install && cd ./src && make setup",

    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {},
        "ghcr.io/devcontainers/features/git:1": {},
        "ghcr.io/devcontainers/features/node:1": { "version": "22" }
    },

    "mounts": [
        "source=${localWorkspaceFolder}/.devcontainer/cache/sonarlint,target=/home/vscode/.sonarlint,type=bind",
        "source=${localWorkspaceFolder}/src,target=/var/www/html/src,type=bind,consistency=cached",
        "source=vendor-cache,target=/var/www/html/src/vendor,type=volume",
        "source=node-cache,target=/var/www/html/src/node_modules,type=volume",
        "source=${localEnv:HOME}/.composer,target=/home/vscode/.composer,type=bind"
    ],

    "customizations": {
        "vscode": {
            "extensions": [
                "bmewburn.vscode-intelephense-client",
                "xdebug.php-debug",

                "SanderRonde.phpstan-vscode",

                "laravel.vscode-laravel",
                "georgykurian.laravel-ide-helper",
                "open-southeners.laravel-pint",
                "amiralizadeh9480.laravel-extra-intellisense",
                "onecentlin.laravel-blade",
                "austenc.laravel-blade-spacer",
                "codingyu.laravel-goto-view",
                "ryannaddy.laravel-artisan",
                "neilbrayfield.php-docblocker",
                "stef-k.laravel-goto-controller",
                "emeraldwalk.RunOnSave",

                "eamodio.gitlens",
                "github.vscode-github-actions",
                "atlassian.atlascode",

                "esbenp.prettier-vscode",
                "dbaeumer.vscode-eslint",
                "ecmel.vscode-html-css",
                "stylelint.vscode-stylelint",
                "bradlc.vscode-tailwindcss",

                "mikestead.dotenv",
                "redhat.vscode-yaml",

                "editorconfig.editorconfig",
                "formulahendry.auto-rename-tag",
                "formulahendry.auto-close-tag",
                "gruntfuggly.todo-tree",
                "vscode-icons-team.vscode-icons",

                "SonarSource.sonarlint-vscode"
            ]
        }
    }
}
